<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Tagalog - Admin Panel</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        .tab-active {
            border-bottom: 2px solid #4f46e5;
            color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-indigo-600 text-white shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold flex items-center">
                <i data-feather="play-circle" class="mr-2"></i>
                Anime Tagalog
            </a>
            <div class="flex items-center space-x-4">
                <a href="index.html" class="hover:text-indigo-200 flex items-center">
                    <i data-feather="home" class="mr-1"></i> Home
                </a>
                <a href="admin.html" class="hover:text-indigo-200 flex items-center font-bold">
                    <i data-feather="settings" class="mr-1"></i> Admin
                </a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i data-feather="settings" class="mr-2"></i> Admin Panel
            </h1>
            
            <div class="border-b border-gray-200 mb-6">
                <ul class="flex" id="tabContainer">
                    <li class="mr-1">
                        <button class="tab-button py-2 px-4 font-medium tab-active" data-tab="anime-list">
                            <i data-feather="list" class="inline h-4 w-4 mr-1"></i> Anime List
                        </button>
                    </li>
                    <li class="mr-1">
                        <button class="tab-button py-2 px-4 font-medium" data-tab="add-anime">
                            <i data-feather="plus-circle" class="inline h-4 w-4 mr-1"></i> Add Anime
                        </button>
                    </li>
                    <li class="mr-1">
                        <button class="tab-button py-2 px-4 font-medium" data-tab="add-episode">
                            <i data-feather="film" class="inline h-4 w-4 mr-1"></i> Add Episode
                        </button>
                    </li>
                </ul>
            </div>
            
            <!-- Anime List Tab -->
            <div id="anime-list" class="tab-content">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center w-1/2">
                        <div class="relative w-full">
                            <input type="text" id="searchAnimeInput" placeholder="Search anime..." 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <i data-feather="search" class="absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"></i>
                        </div>
                    </div>
                    <div>
                        <select id="sortAnimeSelect" class="px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="title">Sort by Title</option>
                            <option value="rating">Sort by Rating</option>
                            <option value="date">Sort by Date Added</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">Episodes</th>
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">Rating</th>
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">Date Added</th>
                                <th class="px-6 py-3 border-b text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="animeListBody">
                            <!-- Anime list will be loaded here -->
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                                    <div class="flex justify-center items-center">
                                        <i data-feather="loader" class="h-5 w-5 animate-spin mr-2"></i> Loading anime list...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="paginationContainer" class="flex justify-center mt-4 space-x-2">
                    <!-- Pagination will be added here -->
                </div>
            </div>
            
            <!-- Add Anime Tab -->
            <div id="add-anime" class="tab-content hidden">
                <h2 class="text-xl font-semibold mb-4">Add New Anime</h2>
                
                <form id="addAnimeForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="animeTitle">
                                Title <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="animeTitle" name="title" required 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="animeYear">
                                Year <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="animeYear" name="year" min="1900" max="2099" required 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="animeStatus">
                                Status
                            </label>
                            <select id="animeStatus" name="status" 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="Ongoing">Ongoing</option>
                                <option value="Completed">Completed</option>
                                <option value="Upcoming">Upcoming</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="animeEpisodes">
                                Total Episodes <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="animeEpisodes" name="episodes" min="1" required 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="animeRating">
                                Rating (0-5)
                            </label>
                            <input type="number" id="animeRating" name="rating" min="0" max="5" step="0.1" 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="animeGenres">
                            Genres (comma separated) <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="animeGenres" name="genres" required 
                            placeholder="Action, Adventure, Comedy, etc." 
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="animeSynopsis">
                            Synopsis <span class="text-red-500">*</span>
                        </label>
                        <textarea id="animeSynopsis" name="synopsis" rows="4" required 
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="animePoster">
                            Poster URL
                        </label>
                        <input type="url" id="animePoster" name="poster" 
                            placeholder="https://example.com/image.jpg" 
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <i data-feather="save" class="inline h-4 w-4 mr-1"></i> Save Anime
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Add Episode Tab -->
            <div id="add-episode" class="tab-content hidden">
                <h2 class="text-xl font-semibold mb-4">Add New Episode</h2>
                
                <form id="addEpisodeForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="episodeAnime">
                            Select Anime <span class="text-red-500">*</span>
                        </label>
                        <select id="episodeAnime" name="animeId" required 
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">-- Select Anime --</option>
                            <!-- Anime options will be loaded here -->
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="episodeNumber">
                                Episode Number <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="episodeNumber" name="episodeNumber" min="1" required 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="episodeTitle">
                                Episode Title
                            </label>
                            <input type="text" id="episodeTitle" name="title" 
                                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Video Sources <span class="text-red-500">*</span>
                        </label>
                        
                        <div class="border border-gray-200 rounded-md p-4 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="server1Url">
                                    Server 1 URL <span class="text-red-500">*</span>
                                </label>
                                <input type="url" id="server1Url" name="server1" required 
                                    placeholder="https://example.com/video.mp4" 
                                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="server2Url">
                                    Server 2 URL (Optional)
                                </label>
                                <input type="url" id="server2Url" name="server2" 
                                    placeholder="https://example.com/video.mp4" 
                                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            
                            <div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="uploadVideo" class="mr-2">
                                    <label for="uploadVideo" class="text-sm font-medium text-gray-700">Upload video file instead</label>
                                </div>
                                
                                <div id="videoUploadContainer" class="mt-2 hidden">
                                    <input type="file" id="videoFile" name="videoFile" accept="video/mp4" 
                                        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <p class="text-xs text-gray-500 mt-1">Max file size: 500 MB</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="episodeDescription">
                            Episode Description
                        </label>
                        <textarea id="episodeDescription" name="description" rows="3" 
                            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <i data-feather="save" class="inline h-4 w-4 mr-1"></i> Save Episode
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-6 mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold">Anime Tagalog</h3>
                    <p class="text-gray-400">Your favorite Tagalog dubbed anime collection</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-indigo-400"><i data-feather="facebook"></i></a>
                    <a href="#" class="hover:text-indigo-400"><i data-feather="twitter"></i></a>
                    <a href="#" class="hover:text-indigo-400"><i data-feather="instagram"></i></a>
                </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-700 text-center text-gray-400">
                <p>&copy; 2025 Anime Tagalog. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Feather icons
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            setupTabs();
            loadAnimeList();
            loadAnimeOptions();
            setupEventListeners();
        });

        // Setup tab navigation
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    
                    // Add active class to clicked button
                    button.classList.add('tab-active');
                    
                    // Hide all tab contents
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    // Show selected tab content
                    const tabId = button.dataset.tab;
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });
        }

        // Load anime list for the table
        function loadAnimeList() {
            fetch('/api/animes')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(animes => {
                    displayAnimeList(animes);
                })
                .catch(error => {
                    console.error('Error loading anime list:', error);
                    const tableBody = document.getElementById('animeListBody');
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-red-500">
                                Failed to load anime list. Please try again later.
                            </td>
                        </tr>
                    `;
                });
        }

        // Display anime list in the table
        function displayAnimeList(animes) {
            const tableBody = document.getElementById('animeListBody');
            tableBody.innerHTML = '';
            
            if (!animes || animes.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No anime added yet.
                        </td>
                    </tr>
                `;
                return;
            }
            
            animes.forEach(anime => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                // Format date
                const addedDate = anime.dateAdded ? new Date(anime.dateAdded).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit'
                }) : 'N/A';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${anime.id}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <img src="${anime.poster || '/api/placeholder/60/90'}" alt="${anime.title}" class="h-10 w-6 object-cover mr-3">
                            <div class="font-medium text-gray-900">${anime.title}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">${anime.episodes || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${parseFloat(anime.rating || 0).toFixed(1)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${addedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex space-x-2">
                            <button class="text-indigo-600 hover:text-indigo-900" onclick="editAnime(${anime.id})">
                                <i data-feather="edit" class="h-5 w-5"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900" onclick="deleteAnime(${anime.id})">
                                <i data-feather="trash-2" class="h-5 w-5"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Reinitialize feather icons for newly added content
            feather.replace();
        }

        // Load anime options for the episode form select
        function loadAnimeOptions() {
            fetch('/api/animes')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(animes => {
                    const select = document.getElementById('episodeAnime');
                    
                    // Clear existing options except the first one
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    if (!animes || animes.length === 0) {
                        const option = document.createElement('option');
                        option.textContent = 'No anime available';
                        option.disabled = true;
                        select.appendChild(option);
                        return;
                    }
                    
                    // Sort animes by title
                    animes.sort((a, b) => a.title.localeCompare(b.title));
                    
                    // Add anime options
                    animes.forEach(anime => {
                        const option = document.createElement('option');
                        option.value = anime.id;
                        option.textContent = anime.title;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading anime options:', error);
                    const select = document.getElementById('episodeAnime');
                    
                    // Clear existing options except the first one
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    const option = document.createElement('option');
                    option.textContent = 'Failed to load anime';
                    option.disabled = true;
                    select.appendChild(option);
                });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Toggle video upload form
            document.getElementById('uploadVideo').addEventListener('change', function() {
                const uploadContainer = document.getElementById('videoUploadContainer');
                if (this.checked) {
                    uploadContainer.classList.remove('hidden');
                } else {
                    uploadContainer.classList.add('hidden');
                }
            });
            
            // Search anime in the list
            document.getElementById('searchAnimeInput').addEventListener('keyup', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#animeListBody tr');
                
                rows.forEach(row => {
                    const titleCell = row.querySelector('td:nth-child(2)');
                    if (!titleCell) return;
                    
                    const title = titleCell.textContent.toLowerCase();
                    if (title.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Sort anime list
            document.getElementById('sortAnimeSelect').addEventListener('change', function() {
                const sortBy = this.value;
                fetch('/api/animes')
                    .then(response => response.json())
                    .then(animes => {
                        let sortedAnimes = [...animes];
                        
                        if (sortBy === 'title') {
                            sortedAnimes.sort((a, b) => a.title.localeCompare(b.title));
                        } else if (sortBy === 'rating') {
                            sortedAnimes.sort((a, b) => parseFloat(b.rating || 0) - parseFloat(a.rating || 0));
                        } else if (sortBy === 'date') {
                            sortedAnimes.sort((a, b) => new Date(b.dateAdded || 0) - new Date(a.dateAdded || 0));
                        }
                        
                        displayAnimeList(sortedAnimes);
                    })
                    .catch(error => {
                        console.error('Error sorting anime list:', error);
                    });
            });
            
            // Add anime form submission
            document.getElementById('addAnimeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(this);
                const animeData = {
                    title: formData.get('title'),
                    year: parseInt(formData.get('year')),
                    status: formData.get('status'),
                    episodes: parseInt(formData.get('episodes')),
                    rating: parseFloat(formData.get('rating') || 0),
                    genres: formData.get('genres').split(',').map(genre => genre.trim()),
                    synopsis: formData.get('synopsis'),
                    poster: formData.get('poster') || null,
                    dateAdded: new Date().toISOString()
                };
                
                // Submit anime data
                fetch('/api/animes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(animeData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Anime added successfully!');
                    this.reset();
                    loadAnimeList();
                    loadAnimeOptions();
                    
                    // Switch to anime list tab
                    document.querySelector('[data-tab="anime-list"]').click();
                })
                .catch(error => {
                    console.error('Error adding anime:', error);
                    alert('Failed to add anime. Please try again.');
                });
            });
            
            // Add episode form submission
            document.getElementById('addEpisodeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const animeId = formData.get('animeId');
                const episodeNumber = parseInt(formData.get('episodeNumber'));
                const uploadVideo = document.getElementById('uploadVideo').checked;
                
                if (uploadVideo) {
                    // Handle file upload
                    const videoFile = document.getElementById('videoFile').files[0];
                    
                    if (!videoFile) {
                        alert('Please select a video file to upload.');
                        return;
                    }
                    
                    const uploadFormData = new FormData();
                    uploadFormData.append('video', videoFile);
                    uploadFormData.append('episodeNumber', episodeNumber);
                    uploadFormData.append('title', formData.get('title') || '');
                    uploadFormData.append('description', formData.get('description') || '');
                    
                    fetch(`/api/animes/${animeId}/episodes/upload`, {
                        method: 'POST',
                        body: uploadFormData
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert('Episode added successfully!');
                        this.reset();
                        document.getElementById('uploadVideo').checked = false;
                        document.getElementById('videoUploadContainer').classList.add('hidden');
                    })
                    .catch(error => {
                        console.error('Error uploading episode:', error);
                        alert('Failed to upload episode. Please try again.');
                    });
                } else {
                    // Handle video URLs
                    const episodeData = {
                        episodeNumber: episodeNumber,
                        title: formData.get('title') || '',
                        description: formData.get('description') || '',
                        sources: {
                            server1: formData.get('server1'),
                            server2: formData.get('server2') || null
                        }
                    };
                    
                    fetch(`/api/animes/${animeId}/episodes`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(episodeData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert('Episode added successfully!');
                        this.reset();
                    })
                    .catch(error => {
                        console.error('Error adding episode:', error);
                        alert('Failed to add episode. Please try again.');
                    });
                }
            });
        }

        // Edit anime function
        function editAnime(animeId) {
            fetch(`/api/animes/${animeId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(anime => {
                    // Switch to add anime tab
                    document.querySelector('[data-tab="add-anime"]').click();
                    
                    // Fill form with anime data
                    document.getElementById('animeTitle').value = anime.title || '';
                    document.getElementById('animeYear').value = anime.year || '';
                    document.getElementById('animeStatus').value = anime.status || 'Ongoing';
                    document.getElementById('animeEpisodes').value = anime.episodes || '';
                    document.getElementById('animeRating').value = anime.rating || '';
                    document.getElementById('animeGenres').value = anime.genres ? anime.genres.join(', ') : '';
                    document.getElementById('animeSynopsis').value = anime.synopsis || '';
                    document.getElementById('animePoster').value = anime.poster || '';
                    
                    // Change form submission to update instead of add
                    const form = document.getElementById('addAnimeForm');
                    
                    // Add hidden input for anime ID
                    let idInput = document.getElementById('editAnimeId');
                    if (!idInput) {
                        idInput = document.createElement('input');
                        idInput.type = 'hidden';
                        idInput.id = 'editAnimeId';
                        idInput.name = 'id';
                        form.appendChild(idInput);
                    }
                    idInput.value = animeId;
                    
                    // Change button text
                    const submitButton = form.querySelector('button[type="submit"]');
                    submitButton.innerHTML = '<i data-feather="save" class="inline h-4 w-4 mr-1"></i> Update Anime';
                    feather.replace();
                    
                    // Change form submission behavior
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        
                        const formData = new FormData(this);
                        const animeData = {
                            id: parseInt(formData.get('id')),
                            title: formData.get('title'),
                            year: parseInt(formData.get('year')),
                            status: formData.get('status'),
                            episodes: parseInt(formData.get('episodes')),
                            rating: parseFloat(formData.get('rating') || 0),
                            genres: formData.get('genres').split(',').map(genre => genre.trim()),
                            synopsis: formData.get('synopsis'),
                            poster: formData.get('poster') || null
                        };
                        
                        fetch(`/api/animes/${animeId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(animeData)
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            alert('Anime updated successfully!');
                            resetAnimeForm();
                            loadAnimeList();
                            loadAnimeOptions();
                            
                            // Switch to anime list tab
                            document.querySelector('[data-tab="anime-list"]').click();
                        })
                        .catch(error => {
                            console.error('Error updating anime:', error);
                            alert('Failed to update anime. Please try again.');
                        });
                    };
                })
                .catch(error => {
                    console.error('Error loading anime for editing:', error);
                    alert('Failed to load anime data for editing. Please try again.');
                });
        }

        // Delete anime function
        function deleteAnime(animeId) {
            if (confirm('Are you sure you want to delete this anime? This action cannot be undone.')) {
                fetch(`/api/animes/${animeId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Anime deleted successfully!');
                    loadAnimeList();
                    loadAnimeOptions();
                })
                .catch(error => {
                    console.error('Error deleting anime:', error);
                    alert('Failed to delete anime. Please try again.');
                });
            }
        }

        // Reset anime form
        function resetAnimeForm() {
            const form = document.getElementById('addAnimeForm');
            form.reset();
            
            // Remove anime ID input if it exists
            const idInput = document.getElementById('editAnimeId');
            if (idInput) {
                idInput.remove();
            }
            
            // Reset button text
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.innerHTML = '<i data-feather="save" class="inline h-4 w-4 mr-1"></i> Save Anime';
            feather.replace();
            
            // Reset form submission behavior
            form.onsubmit = null;
        }
    </script>
    </body>
    </html>
